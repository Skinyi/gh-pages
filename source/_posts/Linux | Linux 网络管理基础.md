---
title: Linux 网路管理基础
lang: zh-CN
tags: 
  - Linux
  - RHEL
  - RHCE
  - 认证考试
categories: 
  - [学习, Linux]
  - [日常记录]
  - [迁移文章]
---
> 🔴 此文章由之前的 Typora 笔记迁移过来，内容可能已经过时。

## 网络接口

可以使用网络端口的名称来识别和配置其连接网络的方式。旧版的 RHEL 以 eth0、eth1、eth2...等名称命名各个网络接口，这种方式存在一定缺陷故已被淘汰。新版 RHEL 采用另一种命名体系。系统将基于固件信息、PCI总线拓扑及网络设备的类型来分配网络接口名称，不再基于检测顺序：

​网络接口的名称以接口类型开头：

- 以太网接口以 *en* 开头；

- WLAN 接口以 *wl* 开头；

- WWAN 接口以 *ww* 开头。

在类型之后，接口名称的其余部分将基于服务器固件所提供的信息，或由 PCI 拓扑中设备的位置确定。

- *oN* 代表这是一个板载设备，且服务器的固件提供设备的索引编号 N。如：eno1 代表板载以太网设备 1。许多服务器不提供此信息；

- *sN* 表示该设备位于 PCI 热插拔插槽 N 中；

- *pMsN* 表示这是一个位于插槽 N 中总线 M 上的 PCI 设备。如：wlp4s0 代表位于插槽 0 中 PCI 总线 4 上的 WLAN 卡。若该卡是一个多功能设备，设备名称中还会添加 *fP*,如 enp0s1f1。

此种命名方法命名的设备的名称之后不会自动发生变化。

## IPV6 地址

### IPv6 地址的简写

​IPv6 地址是一个 128 位数字，通常表示为八组以分号分隔的四个十六进制半字节。每个半字节均表示 4 位的 IPv6 地址，因此每个组表示 16 位的 IPv6 地址。如：

​	*2001:0db8:0000:0010:0000:0000:0000:0001*

​其中，冒号分开的每组中的前导零可以省略，若为 *0000* 仍需保留一个零：

​	*2001:db8:0:10:0:0:0:1*

​其中，一组或多组连续零又可以通过一个 *::* 块来合并：

​	*2001:db8:0:10::1*

>IPv6 地址简写请注意以下原则：
>
>- 抑制组中的前导零；
>- 使用 *::* 来尽可能地缩短；
>- 若地址包含两个连续的零组，且长度相同，则最好将每个组最左边的零组缩短为 *::* ，最右边的组缩短为 *:0:*，长度不同的话使用 *::* 缩短最长的零组，短的使用 *:0:*；
>- 十六进制数字使用小写字母表示；
>- 后面要跟上网络端口时使用方括号将 IPv6 地址括住，如：*[2001:db8:0:10::1]:80*。

### IPv6 子网划分

​普通 IPv6 单薄地址分为两部分：网络前缀和接口 ID。网络前缀标识子网，接口 ID 标识子网中的任一子网接口；与 IPv4 不同，IPv6 具有一个标准的子网掩码 */64*，用于几乎所有普通地址，因此一个 IPv6 地址因此就被分为两半，其中一半是网络前缀、一半是接口 ID。

​通常，网络提供商将为组织分配一个较短的子网掩码，如 */48*。这会保留其余网络部分以用于通过这一分配的前缀来指定子网（长度始终为 */64*）。对于 */48* 分配，将保留16位以用于子网（最多65536）个子网。

<img src="images/image-20210826104209618.png" alt="image-20210826104209618" style="zoom: 67%;" />

​以下列举部分常用 IPv6 地址和网络：

| IPv6地址或网络 | 用途                   | 描述 |
| -------------- | ---------------------- | ---- |
| ::1/128        | 本地主机               | 等效于 IPv4 127.0.0.1/8，在回环接口上设置。 |
| ::             | 未指定的地址           | 等效于 IPv4 0.0.0.0。对于网络服务，这可能标识其正在侦听所有已配置的 IP 地址。 |
| ::/0           | 默认路由（IPv6互联网） | 等效于 IPv4 0.0.0.0/0。路由表中的默认路由与此网络匹配；此网络的路由器是在没有更好路由的情况下发送所有流量的位置。 |
| 2000::/3       | 全局单播地址   | ”普通“的 IPv6 地址，目前由 *IANA* 从该空间进行分配。这等同于范围从 2000::/16 到 3fff::/16 的所有网络。 |
| fd00::/8       | 唯一本地地址（RFC 4193） | 指在一个组织内部可达的ipv6地址，这类地址不能出现在internet上。具有全球唯一的前缀，可以进行网络之间的私有连接，而不必担心地址冲突等问题。如果出现路由泄漏，不会造成Internet路由冲突。在应用中，上层应用程序将这些地址看作全球单播地址。 |
| fe80::/10      | 本地链路地址 | 用于邻居发现协议和无状态自动配置进程中链路本地上节点之间的通信。使用链路本地地址作为源或目的地址的数据包不会被转发到其他链路上。 |
| ff00::/8       | 多播 | 等效于 IPv4 224.0.0.0/4。多播用于同时传输到多个主机，并且在 IPv6 中特别重要，因为 IPv6 没有广播地址。 |

​IPv6 中的本地链路地址是一个无法路由的地址。仅用于与特定网络链路上的主机进行通信。系统上的每个网络接口都通过 fe80::/64 网络上的本地链路地址来自动配置。为确保其唯一性，本地链路地址的接口 ID 是通过网络接口的以太网硬件地址来构建的。

​将 48 位 MAC 地址转换为 64 位接口 ID 的一般方法是反转 7 位的 MAC 地址，然后在其两个中间字节之间插入 *ff:fe*。如：

- 网络前缀：fe80::/64；

- MAC 地址：00:11:22:aa:bb:cc；

- 本地链路地址：fe80::211:22ff:feaa:bbcc/64。

​其他计算机的本地链路地址可以由相同链路上的其他主机像普通地址那样使用。由于每个链路具有 fe80::/64 网络，不能使用路由表来正确地选择出站接口。在地址的结尾必须使用作用域标识符来指定与本地链路地址进行通信时使用的链路。作用域标识符由 *%* 以及后跟的网络接口名称组成。例如，要使用 ping6 对本地链路地址 fe80::211:22ff:feaa:bbcc 进行 ping 操作（使用连接到 ens160 网络接口的链路），正确的命令语法如下：

```bash
[root@localhost ~]\# ping6 fe80::211:22ff:feaa:bbcc%ens160
```

​IPv6 中的一个重要多播地址是 ff02::1（全节点本地链路地址），对此地址进行 ping 操作会将流量都发送到链路上的所有节点。

```bash
[root@localhost ~]\# ping6 ff02::1%ens160
PING ff02::1%ens160(ff02::1%ens160) 56 data bytes
64 bytes from fe80::8af6:d265:9b34:f1d6%ens160: icmp_seq=1 ttl=64 time=0.888 ms
......
```

### IPv6 地址配置

​IPv6 也支持手动配置以及两种动态配置 IPv6 地址的方法，动态分配方式其中的一种是使用 DHCPv6 协议。

​在 IPv6 中，以下接口 ID 是保留的，无法用于主机上的普通网络地址：

- 由链路上的所有路由器使用的全零标识符 *0000:0000:0000:0000*（子网路由器任意广播）。

- 标识符 *fdff:ffff:ffff:ff80* 到 *fdff:ffff:ffff:ffff*。

​由于没有广播地址，DHCPv6 的工作原理与适用于 IPv4 的 DHCP 有所不同。一般来说，主机将 DHCPv6请求从其本地链路地址发送到 *ff02::1:2* 上的端口 *547/UDP*，即全 dhcp 服务器本地链路多播组。然后 DHCPv6 服务器通常向客户端的本地链路地址上的端口 *546/UDP* 发送一个包含相应信息的回复。涉及软件包：dhcp。

​除了 DHCPv6 之外，IPv6 也支持另外一个动态配置方法：SLAAC（无状态地址自动配置）。使用 SLAAC 时，主机通常使用本地链路 *fe80::/64* 地址来调出其接口。主机随后向 *ff02::2*（即，全路由器本地链路多播组）发送一个”路由器请求“。本地链路上的 IPv6 路由器以网络前缀以及其他可能的信息来响应主机的本地链路地址。主机随后将该网络前缀与其通常构建的接口 ID（构建方式与本地链路地址相同）配合使用。路由器定期发送多播更新（路由器播发）以确认或更新其提供的信息。涉及软件包：radvd。

## 域名解析

​使用 ip 地址连接服务器会很不便，使用具有一定代表意义的名称来标识某个主机会更加方便。Linux 有多种机制可以将主机名映射到 ip 地址，称为 *域名解析*。

​一种方法是在各个系统上的 /etc/hosts 文件中为每个名称设置一个静态条目。多台服务器的话需要手动更行每台服务器的文件副本，比较繁琐。

​对于大多数主机，可以使用*域名解析*网络服务，从主机名查找其地址（或进行反查）。DNS（域名服务器）是提供主机名到 ip 地址映射的分布式服务器。域名服务器无需与主机位于同一子网，仅仅可供主机访问即可。Linux 中通常通过 /etc/resolv.conf 文件中的静态设置来配置如何提供域名解析服务。
