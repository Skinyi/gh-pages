---
title: ä½¿ç”¨ ACL æ§åˆ¶å¯¹æ–‡ä»¶çš„è®¿é—®
lang: zh-CN
tags: 
  - Linux
  - RHEL
  - RHCE
  - è®¤è¯è€ƒè¯•
categories: 
  - [å­¦ä¹ , Linux]
  - [æ—¥å¸¸è®°å½•]
  - [è¿ç§»æ–‡ç« ]
---
> ğŸ”´ æ­¤æ–‡ç« ç”±ä¹‹å‰çš„ Typora ç¬”è®°è¿ç§»è¿‡æ¥ï¼Œå†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ã€‚

## æ¦‚è¿°

â€‹ACL,å³è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼Œå®ƒå¯ä»¥æ ¹æ®å®é™…è¦æ±‚æŒ‡å®šå¤šä¸ªç”¨æˆ·å’Œç»„ä»¥ä¸åŒçš„æ–‡ä»¶æƒé™é›†æ¥è®¿é—®æ–‡ä»¶ã€‚å€ŸåŠ© ACLï¼Œå¯ä»¥ä½¿ç”¨ä¸å¸¸è§„æ–‡ä»¶æƒé™ç›¸åŒçš„æƒé™æ ‡å¿—ï¼ˆè¯»å–ã€å†™å…¥å’Œæ‰§è¡Œï¼‰å‘ç”±ç”¨æˆ·åã€ç»„åã€UID æˆ– GID æ ‡è¯†çš„å¤šä¸ªç”¨æˆ·å’Œç»„æˆäºˆæƒé™ã€‚é™¤äº†æ–‡ä»¶æ‰€æœ‰è€…å’Œæ–‡ä»¶çš„ç»„ä»å±å…³ç³»ä¹‹å¤–ï¼Œè¿™äº›é¢å¤–çš„ç”¨æˆ·å’Œç»„åˆ†åˆ«è¢«ç§°ä¸ºæŒ‡å®šç”¨æˆ·å’ŒæŒ‡å®šç»„ï¼Œå› ä¸ºä»–ä»¬ä¸æ˜¯åœ¨é•¿åˆ—è¡¨ä¸­æŒ‡å®šçš„ï¼Œè€Œåœ¨ ACL ä¸­æŒ‡å®šçš„ã€‚

â€‹ç”¨æˆ·å¯ä»¥å¯¹å±äºè‡ªå·±çš„æ–‡ä»¶å’Œç›®å½•è®¾ç½® ACLã€‚è¢«åˆ†é…äº† *CAP_FOWNER* Linux åŠŸèƒ½çš„ç‰¹æƒç”¨æˆ·å¯ä»¥å¯¹ä»»ä½•æ–‡ä»¶æˆ–ç›®å½•è®¾ç½® ACLã€‚æ–°æ–‡ä»¶å’Œå­ç›®å½•ä¼šè‡ªåŠ¨ä»çˆ¶ç›®å½•çš„é»˜è®¤ ACLï¼ˆè‹¥å·²è®¾ç½®ï¼‰ä¸­ç»§æ‰¿ ACL è®¾ç½®ã€‚ä¸å¸¸è§„æ–‡ä»¶çš„è®¿é—®è§„åˆ™ç›¸ä¼¼ï¼Œçˆ¶ç›®å½•å±‚æ¬¡ç»“æ„è‡³å°‘éœ€è¦å…¶ä»–æœç´¢ï¼ˆæ‰§è¡Œï¼‰æƒé™é›†ï¼Œä»¥ä¾¿å¯ç”¨æŒ‡å®šç”¨æˆ·å’ŒæŒ‡å®šç»„çš„è®¿é—®æƒé™ã€‚

â€‹æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿéœ€æŒ‡å®šå¯ç”¨ ACL æ”¯æŒï¼Œå…¶ä¸­ XFS æ–‡ä»¶ç³»ç»Ÿå†…ç½®æœ‰ ACL æ”¯æŒï¼Œext4 æˆ– ext4 é»˜è®¤æƒ…å†µä¸‹ä¼šå¯ç”¨ acl é€‰é¡¹ï¼Œä½†åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œåº”ç¡®è®¤æ˜¯å¦å¯ç”¨äº† ACL æ”¯æŒã€‚è¦å¯ç”¨æ–‡ä»¶ç³»ç»Ÿ ACL æ”¯æŒï¼Œé¡»åœ¨ `mount` å‘½ä»¤æˆ– */etc/fstab* é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿæ¡ç›®ä¸­ä½¿ç”¨ ACL é€‰é¡¹ã€‚

## æŸ¥çœ‹ ACL æƒé™

â€‹ä½¿ç”¨ `ls -l` å‘½ä»¤ä»…æŸ¥çœ‹æ–‡ä»¶æœ€å°‘çš„ ACL è®¾ç½®è¯¦ç»†ä¿¡æ¯ï¼š

```bash
[root@localhost ~]\# ls -l
total 16
-rw-r--r--. 1 root root   18 Sep 16 17:01 1
-rw-------. 1 root root 2760 Jun  3 07:16 anaconda-ks.cfg
-rw-------. 1 root root 2078 Jun  3 07:16 original-ks.cfg
-rw-r--r--. 1 root root  140 Sep 16 17:31 tmp.sh
# æƒé™åˆ—æœ€åä¸€ä¸ªå­—ç¬¦ä¸ºåŠ å·(+)ä»£è¡¨è¯¥æ–‡ä»¶ä¸Šå­˜åœ¨è‹¥å¹²æ¡ç›®çš„æ‹“å±• ACL ç»“æ„ï¼Œä½†æˆ‘æ²¡æ‰¾åˆ°è¿™æ ·çš„æ–‡ä»¶ã€‚
```

> ä½¿ç”¨ `chmod` å‘½ä»¤æ›´æ”¹å…·æœ‰ ACL çš„æ–‡ä»¶çš„ç»„æƒé™åˆ™ä¸ä¼šæ›´æ”¹ç»„æ‰€æœ‰è€…æƒé™ï¼Œè€Œæ˜¯æ›´æ”¹ ACL æ©ç ã€‚å¦‚æœç›®çš„æ˜¯æ›´æ–°æ–‡ä»¶çš„ç»„æ‰€æœ‰è€…æƒé™ï¼Œéœ€ä½¿ç”¨ `setfacl -m g::perms <file>`ã€‚

â€‹ä½¿ç”¨ `getfacl <file>` æŸ¥çœ‹æ–‡ä»¶çš„ ACL è¯¦ç»†ä¿¡æ¯ã€‚

```bash
[root@localhost ~]\# getfacl /run/log/journal/6651ee1da4824a37975cd5245c8cb076/system.journal 
getfacl: Removing leading '/' from absolute path names
# file: run/log/journal/6651ee1da4824a37975cd5245c8cb076/system.journal
# owner: root
# group: systemd-journal
user::rw-
group::r--
group:adm:r--
group:wheel:r--
mask::r--
other::---

```

```bash
[root@localhost ~]\# getfacl .
# file: .
# owner: root
# group: root
user::r-x
group::r-x
other::---

```

â€‹ä¸€ä¸ªè¿›ç¨‹èƒ½å¦è®¿é—®æ–‡ä»¶ï¼Œå°†æŒ‰ç…§ä»¥ä¸‹è§„åˆ™åº”ç”¨æ–‡ä»¶æƒé™å’Œ ACLï¼š

- å¦‚æœæ­£åœ¨ä»¥æ–‡ä»¶æ‰€æœ‰è€…èº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œåˆ™åº”ç”¨æ–‡ä»¶çš„ç”¨æˆ· ACL æƒé™ï¼›
- å¦‚æœæ­£åœ¨ä»¥æŒ‡å®šç”¨æˆ· ACL æ¡ç›®ä¸­åˆ—å‡ºçš„ç”¨æˆ·èº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œåˆ™åº”æŒ‡å®šç”¨æˆ· ACL æƒé™ï¼ˆåªè¦æ©ç å…è®¸ï¼‰ï¼›
- å¦‚æœæ­£åœ¨ä»¥ä¸æ–‡ä»¶çš„ç»„æ‰€æœ‰è€…ç›¸åŒ¹é…çš„ç»„èº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œæˆ–è€…ä»¥å…·æœ‰æ˜¾ç¤ºæŒ‡å®šç»„ ACL æ¡ç›®çš„ç»„èº«ä»½è¿è¡Œè¿›ç¨‹ï¼Œåˆ™åº”ç”¨ç›¸åŒ¹é…çš„ ACL æƒé™ï¼ˆåªè¦æ©ç å…è®¸ï¼‰ï¼›
- å¦åˆ™ï¼Œå°†åº”ç”¨æ–‡ä»¶çš„å…¶ä»– ACL æƒé™ã€‚

> å½“ systemd-journald é…ç½®ä¸ºä½¿ç”¨æŒä¹…å­˜å‚¨æ—¶ï¼Œç³»ç»Ÿç®¡ç†å‘˜åº”åœ¨ /var/log/journal æ–‡ä»¶å¤¹ä¸Šè®¾ç½® ACLã€‚

â€‹*systemd-udevd* ç›‘å¬å†…æ ¸å‘å‡ºçš„è®¾å¤‡äº‹ä»¶ï¼Œå¹¶æ ¹æ® udev è§„åˆ™å¤„ç†æ¯ä¸ªäº‹ä»¶ï¼Œè¯¥æœåŠ¡çš„åŠŸèƒ½ç›¸å½“äº Windows ä¸Šçš„è®¾å¤‡ç®¡ç†å™¨ã€‚å®ƒæ ¹æ®ä¸€ç»„ udev è§„åˆ™ï¼Œæ¥å¯ç”¨æŸäº›è®¾å¤‡çš„ *uaccess* æ ‡è®°ï¼Œå¦‚ CD/DVD æ’­æ”¾å™¨æˆ–åˆ»å½•æœºã€USB å­˜å‚¨è®¾å¤‡ã€å£°å¡ç­‰ç­‰ã€‚æ¯ä¸ªç™»é™† GUI çš„ç”¨æˆ·å°†ä¼šåˆ·æ–°çƒ­æ’æ‹”è®¾å¤‡çš„ ACLã€‚

```bash
[root@localhost ~]\# getfacl /dev/sr0
getfacl: Removing leading '/' from absolute path names
# file: dev/sr0
# owner: root
# group: cdrom
user::rw-
user:student:rw-
group::rw-
mask::rw-
other::---

```

## æ›´æ”¹ ACL æƒé™

â€‹ä½¿ç”¨ `setfacl -m <acl> file` æˆ– `setfacl -M <file> file` æ¥ä¿®æ”¹æ–‡ä»¶çš„ acl è§„åˆ™ã€‚ï¼ˆæ·»åŠ æˆ–ä¿®æ”¹ã€ä¸ä¼šèˆå¼ƒå…¶ä»–è§„åˆ™ï¼‰ã€‚

```bash
[root@localhost ~]\# setfacl -m u:student:rwx tmp.sh
[root@localhost ~]\# getfacl tmp.sh
# file: tmp.sh
# owner: root
# group: root
user::rw-
user:student:rwx
group::r--
mask::rwx
other::r--

```

â€‹ä½¿ç”¨ `setfacl --set <acl> file` æˆ– `setfacl --set-file <file> file` é€‰é¡¹æ¥å®Œå…¨æ›¿ä»£æ–‡ä»¶çš„ acl è§„åˆ™ã€‚ï¼ˆåº”ç”¨æ–°è§„åˆ™ï¼Œèˆå¼ƒæ‰€æœ‰æ—§è§„åˆ™ï¼‰

â€‹é€šè¿‡ç®¡é“å°† fileA æ–‡ä»¶çš„ ACL è§„åˆ™åº”ç”¨è‡³ fileBï¼š

```bash
[root@localhost ~]\# getfacl fileA | setfacl --set-file=- fileB	# - å¯ä»¥æŒ‡å®šä½¿ç”¨ stdin æ–‡ä»¶
```

â€‹ä½¿ç”¨ *-R* é€‰é¡¹å¯ä»¥é€’å½’çš„ä¿®æ”¹ç›®å½•ä¸­æ–‡ä»¶çš„ ACLã€‚

```bash
[root@localhost ~]\# setfacl -R -m u:name:rx directory
```

â€‹ä½¿ç”¨ `setfacl -x <acl> file` æ¥åˆ é™¤ acl æ¡ç›®ï¼š

```bash
[root@localhost ~]\# setfacl -x u:name, g:name file
```

â€‹ä½¿ç”¨ `setfacl -b file` æ¥åˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰ ACL æ¡ç›®ï¼š

```bash
[root@localhost ~]\# setfacl -b tmp.sh
[root@localhost ~]\# getfacl tmp.sh
# file: tmp.sh
# owner: root
# group: root
user::rw-
group::r--
other::r--

```

â€‹ä¸ºäº†ç¡®ä¿åœ¨ç›®å½•ä¸­åˆ›å»ºçš„æ–‡ä»¶å’Œç›®å½•ç»§æ‰¿ç‰¹å®šçš„ ACLï¼Œé¡»åœ¨ç›®å½•ä¸Šä½¿ç”¨é»˜è®¤ ACLã€‚

```bash
[root@localhost ~]\# setfacl -m d:u:name:rx directory
```

â€‹ä½¿ç”¨ `setfacl -k directory` å‘½ä»¤åˆ é™¤ç›®å½•çš„æ‰€æœ‰é»˜è®¤ ACL æ¡ç›®ã€‚

```bash
[root@localhost ~]\# setfacl -k directory
```
