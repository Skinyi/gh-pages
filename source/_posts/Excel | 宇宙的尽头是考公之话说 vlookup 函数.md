---
title: 宇宙的尽头是考公之话说 vlookup 函数
lang: zh-CN
tags: 
  - Excel
  - Office
  - 避免加班
  - 少加班
categories: 
  - [学习, Office]
  - [日常记录]
---

这篇文章构思了很久了，奈何去外地出差加班今天才抽出晚上的时间来写，做私企的社畜确实没有公务员安逸。宁夏公务员招考公告刚发布，今日头条便推送过来了新闻，我也就关注了下。截至 3 月 2 日 10 点，宁夏报名人数达到了 73095 人，社会发展贫富差距拉大以及近年疫情影响下人们追求安稳饭碗的观念愈发深入人心了。生活安稳、工作体面的体制内人员在婚恋市场都有一定的优势，每当我妈手机里的快手直播间操着方言的媒婆说“这家女子想找个体制内的呢”，身在活多钱少的私企的我的寂寞的内心顿时哇凉哇凉的。于是我决定看看今年的报考人数打算打算，不行就争取个以后做我现在公司甲方爸爸的机会，想着我以后刁难我现在同事时的威风，嘴角不禁上扬了起来。

暗中观察到了 3 月 2 日，报名截止的最后一天，10 点出了最后一次的报考人数公示。统计了下最高缴费招考比的职位是 437:1 的民革银川市委员会一级科员，也不知道这个职位有什么吸引人的地方。我也根据我自身的想法，将职位过滤了一遍，最终筛出来的大致自身条件不受限可报的职位有 25 个，接下来就是要决定报哪个了，我想着根据缴费招考比选最低的那个竞争会小一些。要从 25 个职位中一一比对算缴费招考比并进行比较确实有点费劲，如果能计算机辅助的完成这个任务会更好些。

我比对了这两张表，发现他们有两个共同的列：职位名称和职位代码。看到职位代码，作为技术人员的我想到了主键和 SQL。如果能在 Excel 中执行 SQL 查询，我上面的问题不难解决而且强大的 Excel 也确实内置了对 SQL 的支持，但其实像我现在的问题根本用不着这么复杂的方法，最好的方法是用 Excel 数据处理的函数大法。

以上问题的解决思路可以被分解为：1. 从表二根据表一筛选出来的职位代码（职位名称也行，但我还是习惯用可以标识唯一性的代码串）查出缴费人数和招考人数并记录在表一；2. 在表一计算缴费和招考人数的比例；3. 表一根据此比例进行排序；4. 从表一根据排序结果综合自身其他意愿选择报考职位。

以上解决方法中最难的其实是第一步，其他方法中涉及的计算和排序都十分简单。很多人都不太会用到 Excel 提供的一个强大的查找函数 vlookup 可以满足步骤一的需要。以下是这个函数的介绍：

> VLOOKUP(lookup_value,table_array,col_index_num,\[range_lookup\]) 按行查找表格或区域内容
>
> 其中各参数的意义是：
> * lookup_value：要查找的值，也被称为查阅值（该参数既可以是单元格也可以是定值）。
> * table_array：查阅值所在的区域。 需注意：查阅值应该始终位于所在区域的第一列，这样 VLOOKUP 才能正常工作。 例如，如果查阅值位于单元格 C2 内，那么你的区域应该以 C 开头。
> * col_index_num：区域中包含返回值的列号。 例如，如果指定 B2：D11 作为区域，则应该将 B 计为第一列，将 C 作为第二列，以此类比。
> * range_lookup：（可选）如果需要返回值的近似匹配，可以指定 TRUE；如果需要返回值的精确匹配，则指定 FALSE。 如果没有指定任何内容，默认值将始终为 TRUE 或近似匹配。

了解这个函数之后就很简单了，为了方便，在表一所在的工作簿新建工作表，将表二的内容复制过去，如图：

![将表二的主要内容复制到表一所在工作簿的新建工作表](images/office/准备工作.png)

在职位表新建列：缴费人数、缴费招考比。职位表的结构就变成了：

| ◢    | A    | B        | C                              | D                                                            | E        | F        | G                                    | H          | I          | J        | K        | L                                                            | M            | N                             | O        | P          |
| ---- | ---- | -------- | ------------------------------ | ------------------------------------------------------------ | -------- | -------- | ------------------------------------ | ---------- | ---------- | -------- | -------- | ------------------------------------------------------------ | ------------ | ----------------------------- | -------- | ---------- |
| 1    | 序号 | 招考单位 | 部门及职位                     | 职位简介                                                     | 职位代码 | 招考人数 | 专业要求                             | 学历要求   | 学位要求   | 政治面貌 | 其他条件 | 备注                                                         | 申论试卷类型 | 联系电话                      | 缴费人数 | 缴费招考比 |
| 308  | 304  | 石嘴山市 | 石嘴山市市直部门一级科员（一） | 负责综合管理服务、信息化建设、工程建设项目规划、项目审批等工作 | 017001   | 2        | 计算机类、电子信息类、建筑类、水利类 | 本科及以上 | 学士及以上 | 不限     | 限男性   | 合并职位：市人力资源和社会保障局1人、民政局1人、团市委（参照公务员法管理群团机关）1人、就业创业服务局（参照公务员法管理事业单位）1人 | A卷          | 0952-2012332     0952-2218747 | 140      | 70         |
| ...  | ...  | ...      | ...                            | ...                                                          | ...      | ...      | ...                                  | ...        | ...        | ...      | ...      | ...                                                          | ...          | ...                           | ...      | ...        |

然后就可以用 vlookup 函数自动从统计表根据职位代码查找到对应职位的缴费人数。简单起见，可以用 Excel 的函数向导手动可视化的选择或确定出函数的参数，从菜单栏选中：公式-插入函数，在搜索函数对话框里输入 vlookup 并点击转到，然后确保从选择函数中选中 vlookup 后点击确定。

![进入函数参数界面](images/office/函数参数.png)

点击每项参数后面红圈里的按钮就可以在工作表中选择参数或参数范围：

![插入函数参数](images/office/插入函数参数.png)

最终完整函数形式是：=VLOOKUP(E308,统计表!D2:I765,6,0)，意思是从统计表的 D2 到 I765 的单元格范围内对比 D 列的值是否为 E308 里的值，若精确匹配则返回该单元格所选范围的第六行的值为该函数的结果。

观察之后发现对应正确，然后就可以用 Excel 强大的填充工具将其他职位的缴费人数也根据第一个筛选出来的岗位填充进去。在我的操作中，填充后的函数虽然有问题但工作良好，因为职位表和统计表的职位表的排序是对应的，此时若在未对应的情况下就会出现问题，有的单元格可能会出现 *#N/A* 值。

造成上述问题的原因是我们未锁定 table_array 参数的所选范围的行值，每次往下下拉填充统计范围的行值都会自增，如我在下面随便选中的一个填充后的单元格的公式变成了：=VLOOKUP(E615,统计表!D486:I1249,6,0)，这在无序情况下会出错。

为了使该参数固定，可以借助 *$* 符号进行限定，这样每次填充时该函数的第二个参数就是不变的了。

于是，筛选后的职位表的第一行的公式可以写成：=VLOOKUP(E308,统计表!D$2:I$765,6,0)，然后再往下填充。再选中刚才填充的公式，其变成了：=VLOOKUP(E615,统计表!D$2:I$765,6,0)，这样就比较精准了。

计算缴费招考比，以筛选后的职位表的第一行为例：=O308/F308。然后用排序工具排序就行。

看了最后的结果，不仅感叹现在的公务员考试越来越卷，我估计我也将只会是陪考员中的一员。由此看来还是再钻研钻研 Excel 的 SQL 查询功能比较现实。