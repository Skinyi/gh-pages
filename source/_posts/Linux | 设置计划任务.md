---
title: è®¾ç½®ä»»åŠ¡è®¡åˆ’
lang: zh-CN
tags: 
  - Linux
  - RHEL
  - RHCE
  - è®¤è¯è€ƒè¯•
categories: 
  - [å­¦ä¹ , Linux]
  - [æ—¥å¸¸è®°å½•]
  - [è¿ç§»æ–‡ç« ]
---
> ğŸ”´ æ­¤æ–‡ç« ç”±ä¹‹å‰çš„ Typora ç¬”è®°è¿ç§»è¿‡æ¥ï¼Œå†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ã€‚

## è®¾ç½®ä¸€æ¬¡æ€§ä»»åŠ¡

â€‹ä½¿ç”¨ `at` å‘½ä»¤å¯ä»¥è®¾ç½®åœ¨å°†æ¥æŸä¸ªè®¾å®šçš„ç‚¹è¿è¡Œä¸€ä¸ªå‘½ä»¤æˆ–ä¸€ç»„å‘½ä»¤ã€‚æ­¤å‘½ä»¤çš„æ‰§è¡Œå’Œç”Ÿæ•ˆä¾èµ–äº *atd* æœåŠ¡ï¼Œè¦ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œè¯·ç¡®ä¿å·²ç»å®‰è£…è¯¥è½¯ä»¶åŒ…ä¸” *atd* æœåŠ¡å·²ç»å¯åŠ¨ã€‚

â€‹ä½¿ç”¨ *at* è®¾ç½®çš„ä»»åŠ¡ä¼šè¿›å…¥ *a* åˆ° *z* 26 ä¸ªé˜Ÿåˆ—ï¼Œä½œä¸šæŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼Œé˜Ÿåˆ—è¶Šå¾€ååˆ™ä¼˜å…ˆçº§è¶Šä½ã€‚

### ç”¨æ³•

â€‹ä½¿ç”¨ `at TIMESPEC` æ¥è®¾ç½®æ–°çš„ä½œä¸šï¼š

```bash
[root@localhost ~]\# at now + 5min
warning: commands will be executed using /bin/sh
at> # æ¥ç€è¾“å…¥è‡ªå·±æƒ³è®¾ç½®çš„å‘½ä»¤ï¼ŒæŒ‰ Ctrl + D æ¥å®Œæˆè¾“å…¥
```

â€‹å¯¹äºå¤æ‚çš„é•¿ä¸²å‘½ä»¤ï¼Œä½¿ç”¨é‡å®šå‘å¯¼å…¥è¦æ¯”æ‰‹åŠ¨è¾“å…¥æ›´æ–¹ä¾¿ï¼Œå¦‚ï¼š

```bash
[root@localhost ~]\# at now + 5min < myscript.txt # å…¶ä¸­ myscript.txt ä¸­å·²è®¾ç½®å¥½è¦æ‰§è¡Œçš„å‘½ä»¤
```

â€‹å…¶ä¸­ *TIMESPEC* çš„å½¢å¼è¾ƒä¸ºçµæ´»ï¼Œä»¥ä¸‹åˆ—å‡ºäº†ä¸€äº›å¯ç”¨çš„å½¢å¼ï¼š

- now + 5min;
- teatime tomorrow;ï¼ˆä¸‹åˆèŒ¶æ—¶é—´ä¸º 16:00ï¼‰

- noon + 4days;
- 5pm august 3 2021ã€‚

### ç®¡ç†è®¡åˆ’çš„ä»»åŠ¡

â€‹ä½¿ç”¨å‘½ä»¤ `atq` æˆ– `at -l` æ¥è·å¾—å½“å‰ç”¨æˆ·çš„å¾…å¤„ç†ä½œä¸šçš„åˆ—è¡¨ã€‚

```bash
[root@localhost ~]\# at -l
3	Fri Sep 17 11:04:00 2021 a root
# ç¼–å· æ—¥æœŸ æ—¶é—´ æ‰€å¤„çš„é˜Ÿåˆ—ç¼–å· ä½œä¸šæ‰€æœ‰è€…å³æ‰§è¡Œè€…
```

â€‹ä½¿ç”¨å‘½ä»¤ `at -c JOBNUMBER` å‘½ä»¤æŸ¥çœ‹æŒ‡å®šä½œä¸šç¼–å·çš„è®¡åˆ’ä½œä¸šçš„ç¯å¢ƒå’Œæ‰§è¡Œå†…å®¹ã€‚

```bash
[root@localhost ~]\# at -c 3
#!/bin/sh
# atrun uid=0 gid=0
# mail root 0
umask 22
......
```

â€‹ä½¿ç”¨å‘½ä»¤ `atrm JOBNUMBER` å‘½ä»¤æ¥åˆ é™¤è®¡åˆ’çš„ä½œä¸šã€‚

```bash
[root@localhost ~]\# atrm 3
Cannot find jobid 3
```

> ä½¿ç”¨ `watch` å‘½ä»¤å¯ä»¥è®¾ç½®æ¯ä¸€æ®µæ—¶é—´æ‰§è¡Œå‘½ä»¤å¹¶å°†å…¶ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Šã€‚

## è®¾ç½®å‘¨æœŸæ€§ä½œä¸š

â€‹ä½¿ç”¨ `crontab` å‘½ä»¤å¯ä»¥è®¾ç½®å‘¨æœŸæ€§æ‰§è¡Œçš„ä½œä¸šï¼Œæ­¤å‘½ä»¤çš„è®¾ç½®å’Œæ‰§è¡Œä¾èµ–äº *crond* å®ˆæŠ¤è¿›ç¨‹ï¼Œ*crond* å®ˆæŠ¤è¿›ç¨‹ä¼šè¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼ˆæ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼‰ä»¥åŠä¸€ç»„ç³»ç»ŸèŒƒå›´å†…çš„æ–‡ä»¶ã€‚è¿™äº›é…ç½®æ–‡ä»¶ä½¿ç”¨æˆ·å’Œç®¡ç†å‘˜æ‹¥æœ‰ç»†å¾®çš„æ§åˆ¶æƒï¼Œå¯ä»¥æ§åˆ¶åº”æ‰§è¡Œå‘¨æœŸä½œä¸šçš„æ—¶é—´ã€‚

### ç”¨æ³•

| å‘½ä»¤             | ç”¨é€”                                                         |
| ---------------- | ------------------------------------------------------------ |
| crontab -l       | åˆ—å‡ºå½“å‰ç”¨æˆ·çš„è®¡åˆ’ä½œä¸š                                       |
| crontab -r       | åˆ é™¤å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ä½œä¸š                                       |
| crontab -e       | ç¼–è¾‘å½“å‰ç”¨æˆ·çš„ä½œä¸š                                           |
| crontab filename | åˆ é™¤æ‰€æœ‰ä½œä¸šï¼Œå¹¶æ›¿æ¢ä¸ºä» filename è¯»å–çš„ä½œä¸šã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨ stdinã€‚ |

> Root ç”¨æˆ·å¯ä»¥ä½¿ç”¨ `crontab -u <USER>` å‘½ä»¤æ¥ç®¡ç†å…¶ä»–ç”¨æˆ·çš„ä½œä¸šï¼Œä¸åº”ä»¥ root ç”¨æˆ·ç›´æ¥è®¾ç½®ç³»ç»Ÿä½œä¸šï¼Œè€Œåº”é€šè¿‡ä¿®æ”¹ /etc/crontab é…ç½®æ–‡ä»¶ã€‚

â€‹`crontab -e` å‘½ä»¤ä¼šé»˜è®¤è°ƒç”¨ vim ç¼–è¾‘å™¨ï¼ˆé™¤é EDITOR ç¯å¢ƒå˜é‡æŒ‡å®šå…¶ä»–è®¾ç½®ï¼‰æ¥ç¼–è¾‘ä»»åŠ¡è®¡åˆ’è®¾ç½®æ–‡ä»¶ï¼Œæ¯è¡Œåªè¾“å…¥ä¸€ä¸ªä½œä¸šï¼Œé™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä½¿ç”¨æ³¨é‡Šã€å˜é‡ä»¥åŠç©ºè¡Œã€‚å…¶ä¸­å¸¸è§å˜é‡çš„è®¾ç½®åŒ…æ‹¬ SHELL å˜é‡å’Œ MAILTO å˜é‡ã€‚

â€‹Crontab æ–‡ä»¶ä¸­çš„å­—æ®µæŒ‰ä»¥ä¸‹é¡ºåºæ˜¾ç¤ºï¼šåˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€æ˜ŸæœŸã€å‘½ä»¤ã€‚

> è‹¥æŒ‡å®šçš„æ—¥å’Œæ˜ŸæœŸéƒ½ä¸æ˜¯ *\**ï¼Œåˆ™è¯¥å‘½ä»¤ä¼šåœ¨æ¯ä¸ªæŒ‡å®šçš„æ—¥æœŸæˆ–æ˜ŸæœŸæ‰§è¡Œã€‚

â€‹å‰äº”ä¸ªå­—æ®µå…¨éƒ¨ä½¿ç”¨ç›¸åŒçš„è¯­æ³•è§„åˆ™ï¼š

- *\** è¡¨ç¤º â€œæ— å…³ç´§è¦â€ æˆ–å§‹ç»ˆï¼›

- *æ•°å­—* å¯ç”¨äºæŒ‡å®šä¸åŒæ—¶é—´æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯ 1-6 åˆ†åˆ«è¡¨ç¤ºæ˜ŸæœŸä¸€è‡³æ˜ŸæœŸå…­ï¼Œ0 æˆ– 7 éƒ½å¯ä»¥ä»£è¡¨æ˜ŸæœŸå¤©ï¼›

- *x\-y* è¡¨ç¤ºèŒƒå›´ï¼Œ(xï¼Œy]ï¼›

- *x,y* è¡¨ç¤ºåˆ—è¡¨ï¼Œåˆ—è¡¨ä¹Ÿå¯åŒ…å«èŒƒå›´ï¼Œå¦‚åˆ†é’Ÿåˆ—å¯ä»¥è®¾ç½®æˆ *5, 10-13, 17*ï¼›

- *\*/x* è¡¨ç¤ºæ¯ x æ—¶é—´çš„é—´éš”ï¼Œå¦‚æŒ‡å®šåˆ†é’Ÿåˆ— \*/7 ä»£è¡¨æ¯ 7 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ä½œä¸šã€‚

â€‹æ­¤å¤–ï¼Œæœˆä»½å’Œæ˜ŸæœŸä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‰ä¸ªå­—æ¯çš„ç¼©å†™æ¥è¡¨ç¤ºï¼Œå¦‚ï¼šJanã€Febã€Mar...ä»¥åŠ Monã€Tueã€Wed...ã€‚

> å‘½ä»¤å­—æ®µä¸­è‹¥åŒ…å«æœªè½¬ä¹‰çš„ *%* ç¬¦å·ï¼Œåˆ™è¯¥ç™¾åˆ†æ¯”ç¬¦å·å°†è¢«å½“ä½œæ¢è¡Œå­—ç¬¦ï¼Œä¸”ç™¾åˆ†æ¯”ä¹‹åçš„æ‰€æœ‰å†…å®¹å°†ä¼ ç»™ *stdin* ä¸­çš„å‘½ä»¤ã€‚

### ä½œä¸šç¤ºä¾‹

â€‹ä»¥ä¸‹ä½œä¸šå°†åœ¨æ¯å¹´ 2 æœˆ 2 æ—¥ä¸Šåˆ 9 ç‚¹å‡†ç‚¹æ‰§è¡Œå‘½ä»¤ /usr/local/bin/yearly_backupã€‚

```bash
0 9 2 2 * /usr/local/bin/yearly_backup
```

â€‹ä»¥ä¸‹ä½œä¸šå°†åœ¨æ¯ä¸ªå·¥ä½œæ—¥åˆå¤œå‰çš„ä¸¤åˆ†é’Ÿè¿è¡Œå‘½ä»¤ /usr/local/bin/daily_reportã€‚

```bash
58 23 * * 1-5 /usr/local/bin/daily_report
```

â€‹ä»¥ä¸‹ä½œä¸šå°†åœ¨æ¯ä¸ªå·¥ä½œæ—¥ï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰ä¸Šåˆ 9 ç‚¹æ‰§è¡Œ mutt å‘½ä»¤ï¼Œä»è€Œå°†é‚®ä»¶æ¶ˆæ¯ Checking in å‘é€ç»™æ”¶ä»¶äºº boss@example.com ã€‚

```bash
0 9 * * 1-5 mutt -s "Check in" boss@example % Hi there boss, just checking in.
```

## å‘¨æœŸæ€§ç³»ç»Ÿä½œä¸š

â€‹è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å‚è€ƒæ–‡ç« ï¼šhttps://cloud.tencent.com/developer/article/1619542ï¼Œå†™çš„éå¸¸è¯¦ç»†ã€‚

â€‹ç³»ç»Ÿç®¡ç†å‘˜ç»å¸¸éœ€è¦è¿è¡Œå‘¨æœŸæ€§ä½œä¸šï¼Œæœ€ä½³çš„åšæ³•æ˜¯ä»ç³»ç»Ÿè´¦æˆ·è€Œä¸æ˜¯ä»ç”¨æˆ·è´¦æˆ·è¿è¡Œè¿™äº›ä½œä¸šï¼Œå³ä¸ç”¨ä½¿ç”¨ `crontab` å‘½ä»¤æ¥å®‰æ’è¿™äº›ä½œä¸šï¼Œè€Œæ˜¯è¦ä½¿ç”¨ç³»ç»ŸèŒƒå›´çš„ crontab æ–‡ä»¶ã€‚

â€‹/etc/crontab æ–‡ä»¶çš„è¯­æ³•è·Ÿæ™®é€šç”¨æˆ·åˆ›å»º crontab ä»»åŠ¡ç±»ä¼¼ï¼Œcrontab æ–‡ä»¶ä¸­éœ€é¢å¤–æŒ‡å®šä¸€ä¸ªç”¨æˆ·å­—æ®µï¼š

```bash
[root@localhost ~]\# cat /etc/crontab | grep ^# 
# For details see man 4 crontabs
# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```

â€‹å‘¨æœŸæ€§ç³»ç»Ÿä½œä¸šå¯ä»¥åœ¨ä¸¤ä¸ªä½ç½®å®šä¹‰ï¼š*/etc/crontab* æ–‡ä»¶å’Œ */etc/cron.d* ç›®å½•ä¸­çš„è‡ªå®šä¹‰æ–‡ä»¶ï¼ˆæ¨èï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œcrontab ç³»ç»Ÿä¸­è¿˜åŒ…å«éœ€è¦æ¯å°æ—¶ã€æ¯å¤©ã€æ¯å‘¨å’Œæ¯æœˆè¿è¡Œçš„è„šæœ¬çš„å­˜å‚¨åº“ï¼Œè¿™äº›å­˜å‚¨åº“åˆ†åˆ«å¯¹åº”äºåä¸º */etc/cron.hourly*ã€*/etc/cron.daily*ã€*/etc/cron.weekly*ã€*/etc/cron.monthly* çš„ç›®å½•ã€‚è¿™äº›ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯è„šæœ¬æ–‡ä»¶è€Œä¸æ˜¯ crontab é…ç½®æ–‡ä»¶ã€‚

> è¿™äº›æ–‡ä»¶å¤¹ä¸­çš„è„šæœ¬æ–‡ä»¶éœ€è¦è¢«æˆäºˆæ‰§è¡Œæƒé™ï¼Œå¦åˆ™å°†ä¸ä¼šè§¦å‘ã€‚

â€‹ä¸ºäº†å¤„ç†ç”±äºç³»ç»Ÿå…³æœºç­‰æŸäº›åŸå› å¯¼è‡´çš„ä¸€äº›ä»»åŠ¡è®¡åˆ’ç”±äºè¶…å‡ºæ—¶é—´èŒƒå›´è€Œæœªè¢« crontab æ‰§è¡Œçš„é—®é¢˜ï¼Œanacron è¢«å¼•å…¥ï¼Œanacron æ¯å°æ—¶è¢« crond æœåŠ¡æ‰§è¡Œä¸€æ¬¡ä»¥æ£€æŸ¥ä¸€äº›ä»»åŠ¡è®¡åˆ’æ˜¯å¦åœ¨è®¾å®šçš„æ—¶é—´æ‰§è¡Œï¼Œè‹¥æœ‰åˆ™æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¾…æ‰§è¡Œå®Œæ¯•æˆ–è€…æ— ä»»ä½•é€¾æœŸçš„ä»»åŠ¡è®¡åˆ’æ—¶å°±ä¼šç»“æŸ anacron è¿›ç¨‹ã€‚

â€‹åœ¨ /etc/cron.hourly å¯ä»¥æ‰¾åˆ° anacron çš„é…ç½®æ‰§è¡Œæ–‡ä»¶ï¼š

```bash
#!/bin/sh
# Check whether 0anacron was run today already
if test -r /var/spool/anacron/cron.daily; then
    day=`cat /var/spool/anacron/cron.daily`
fi
if [ `date +%Y%m%d` = "$day" ]; then
    exit 0
fi

# Do not run jobs when on battery power
online=1
for psupply in AC ADP0 ; do
    sysfile="/sys/class/power_supply/$psupply/online"

    if [ -f $sysfile ] ; then
        if [ `cat $sysfile 2>/dev/null`x = 1x ]; then
            online=1
            break
        else
            online=0
        fi
    fi
done
if [ $online = 0 ]; then
    exit 0
fi
/usr/sbin/anacron -s
```

## SYSTEMD å®šæ—¶å™¨

### ä¸€äº›æ“ä½œç³»ç»Ÿè®¾å®šçš„è®¡æ—¶å™¨

```bash
[root@localhost etc]\# systemctl status *timer
â— dnf-makecache.timer - dnf makecache --timer
   Loaded: loaded (/usr/lib/systemd/system/dnf-makecache.timer; enabled; vendor preset>
   Active: active (waiting) since Fri 2021-09-17 09:07:25 CST; 6h ago
  Trigger: Fri 2021-09-17 16:23:21 CST; 36min left

Sep 17 09:07:25 localhost.localdomain systemd[1]: Started dnf makecache --timer.
......
```

### è‡ªå®šä¹‰å®šæ—¶å™¨

â€‹åœ¨ */etc/systemd/system* ä¸‹æ·»åŠ è‡ªå®šä¹‰å®šæ—¶å™¨å•å…ƒé…ç½®æ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```ini
[Unit]
Description=â€å¯¹è¯¥å®šæ—¶å™¨åŠŸèƒ½çš„æè¿°â€œ

[Timer]
# ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´
OnCalendar=*-*-* *:*:00	
# ç²¾åº¦ï¼ˆç§’ï¼‰ï¼Œå…è®¸æµ®åŠ¨çš„åå·®
AccuracySec=24h
# æ˜¯å¦
Persistent=true
# æœ€å¤§éšæœºå»¶è¿Ÿæ—¶é—´
#RandomizedDelaySec=14400
# å®šæ—¶å™¨è¢«æ¿€æ´»æ—¶æ‰§è¡Œçš„æœåŠ¡
Requires=MyService.service

[Install]
WantedBy=timers.target
```
